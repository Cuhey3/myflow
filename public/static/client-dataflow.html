<html>
    <body>
        <div id="foo"></div>
        <script>
            function Producer(){}
            Producer.prototype.processors = [];
            Producer.prototype.to = function(func){
                Producer.prototype.processors.push(func);
                return this;
            };
        
            function Consumer(){}
            Consumer.prototype = new Producer();
            Consumer.prototype.consume = exchange => {
                for(var i = 0; i < Consumer.prototype.processors.length; i++){
                    exchange = Consumer.prototype.processors[i](exchange);
                }
                return exchange;
            };
            function RouteId(){}
            RouteId.prototype = new Consumer();
        
            var exchange = {'foo':'bar'};
            
            var route = new RouteId()
                .to(exchange => {
                    exchange['wao'] = 'wao';
                    return exchange;
                })
                .to(exchange => {
                    document.getElementById('foo').innerHTML = '<h1>aaa</h1>'
                    exchange['wai'] = 'wai';
                    return exchange;
                });
        
            exchange = route.consume(exchange);
            console.log(exchange);
            // â‡’ Object {foo: "bar", wao: "wao"}
        </script>

    </body>
</html>